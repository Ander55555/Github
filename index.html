<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Explorer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar to match theme */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-black text-zinc-100 font-sans selection:bg-zinc-800 selection:text-white min-h-screen flex flex-col">

    <!-- Header -->
    <header class="border-b border-zinc-800 bg-black/80 backdrop-blur-md sticky top-0 z-20">
        <div class="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-2">
                <div class="bg-white p-1 rounded-full">
                    <i data-lucide="github" class="w-6 h-6 text-black"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-white">
                    GitHub<span class="text-zinc-500">Explorer</span>
                </h1>
            </div>
            
            <form id="search-form" class="w-full md:w-96 relative group">
                <div class="absolute inset-0 bg-gradient-to-r from-zinc-800 to-zinc-700 rounded-full blur opacity-25 group-focus-within:opacity-50 transition duration-500"></div>
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search username..."
                    class="relative w-full bg-black border border-zinc-800 rounded-full py-2 pl-4 pr-12 focus:outline-none focus:border-zinc-600 focus:ring-1 focus:ring-zinc-600 text-sm placeholder-zinc-600 transition-all text-white"
                />
                <button 
                    type="submit"
                    id="search-btn"
                    class="absolute right-1 top-1 p-1.5 bg-zinc-800 hover:bg-zinc-700 rounded-full text-zinc-300 transition-colors z-10"
                >
                    <i data-lucide="search" class="w-4 h-4"></i>
                </button>
            </form>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8 flex-1 w-full">
        
        <!-- Error State -->
        <div id="error-container" class="hidden mb-8 p-4 bg-red-900/20 border border-red-900/50 rounded-lg flex items-center gap-3 text-red-400">
            <i data-lucide="alert-circle" class="w-5 h-5 flex-shrink-0"></i>
            <p id="error-message"></p>
        </div>

        <!-- Loading State -->
        <div id="main-loader" class="hidden flex flex-col items-center justify-center py-20 gap-4">
            <i data-lucide="loader-2" class="w-8 h-8 text-zinc-500 animate-spin"></i>
            <p class="text-zinc-600 text-sm font-mono">INITIALIZING UPLINK...</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8 fade-in">
            
            <!-- Sidebar: User Profile -->
            <aside class="lg:col-span-4 space-y-6">
                <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-6 relative overflow-hidden">
                    <div id="profile-content" class="flex flex-col items-center text-center relative z-10">
                        <!-- Content injected by JS -->
                    </div>
                </div>
            </aside>

            <!-- Repositories -->
            <div class="lg:col-span-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold flex items-center gap-2 text-white">
                        <i data-lucide="book" class="w-5 h-5 text-zinc-500"></i>
                        Projects
                    </h3>
                    <span class="text-xs text-zinc-500 bg-zinc-900 border border-zinc-800 px-3 py-1 rounded-full">
                        Latest Updates
                    </span>
                </div>

                <div id="repos-list" class="grid grid-cols-1 gap-4">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </div>

        <!-- Welcome / Empty State -->
        <div id="welcome-state" class="hidden text-center py-24">
            <div class="w-16 h-16 bg-zinc-900 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-zinc-800">
               <i data-lucide="github" class="w-8 h-8 text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">System Ready</h2>
            <p class="text-zinc-500">Enter a target identity to initialize projection.</p>
        </div>
    </main>

    <!-- Code Viewer Modal -->
    <div id="modal-backdrop" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity opacity-0">
        <div id="modal-content" class="bg-zinc-900 w-full max-w-4xl h-[80vh] rounded-2xl border border-zinc-700 shadow-2xl flex flex-col overflow-hidden transform scale-95 transition-transform">
            
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-zinc-800 bg-zinc-950">
               <div class="flex items-center gap-3 overflow-hidden">
                 <button id="modal-close-btn" class="p-1 hover:bg-zinc-800 rounded text-zinc-400 hover:text-white transition">
                   <i data-lucide="x" class="w-5 h-5"></i>
                 </button>
                 <div class="flex flex-col overflow-hidden">
                   <h3 id="modal-repo-name" class="text-white font-bold flex items-center gap-2">
                     Repo Name
                     <span class="px-2 py-0.5 rounded bg-zinc-800 text-[10px] text-zinc-400 font-normal border border-zinc-700">beta</span>
                   </h3>
                   <div class="flex items-center gap-1 text-xs text-zinc-500 font-mono mt-1 overflow-hidden">
                      <span class="flex-shrink-0">root/</span>
                      <span id="modal-current-path" class="truncate"></span>
                   </div>
                 </div>
               </div>
            </div>

            <!-- Modal Body -->
            <div id="modal-body" class="flex-1 overflow-auto bg-black p-0 relative">
                <!-- Dynamic Content: Loader, Error, File List, or File Content -->
            </div>
            
            <!-- Modal Footer -->
            <div class="bg-zinc-950 p-2 border-t border-zinc-800 flex justify-center">
               <span class="text-[10px] text-zinc-600 font-mono">
                 Powered by GitHub API ‚Ä¢ Read-Only Mode
               </span>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // State
        let userData = null;
        let repos = [];
        let activeRepo = null;
        let currentPath = '';
        let fileContent = null;
        let dirContents = [];

        // DOM Elements
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const mainLoader = document.getElementById('main-loader');
        const dashboard = document.getElementById('dashboard');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const profileContent = document.getElementById('profile-content');
        const reposList = document.getElementById('repos-list');
        const welcomeState = document.getElementById('welcome-state');
        
        // Modal Elements
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalBody = document.getElementById('modal-body');
        const modalRepoName = document.getElementById('modal-repo-name');
        const modalCurrentPath = document.getElementById('modal-current-path');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            fetchGitHubData('facebook'); // Default load
        });

        // Search Handler
        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if(query) fetchGitHubData(query);
        });

        // Modal Close
        modalCloseBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', (e) => {
            if(e.target === modalBackdrop) closeModal();
        });

        // Main Fetch Logic
        async function fetchGitHubData(username) {
            setLoading(true);
            setError(null);
            
            try {
                // Fetch User
                const userRes = await fetch(`https://api.github.com/users/${username}`);
                if (!userRes.ok) throw new Error(userRes.status === 404 ? 'User not found' : 'Failed to fetch user');
                userData = await userRes.json();

                // Fetch Repos
                const reposRes = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=12`);
                if (reposRes.ok) repos = await reposRes.json();
                else repos = [];

                renderDashboard();
            } catch (err) {
                setError(err.message);
                dashboard.classList.add('hidden');
                welcomeState.classList.add('hidden');
            } finally {
                setLoading(false);
            }
        }

        // Render Functions
        function renderDashboard() {
            // Profile
            profileContent.innerHTML = `
                <div class="relative group cursor-pointer">
                    <div class="absolute -inset-1 bg-gradient-to-r from-zinc-700 to-zinc-600 rounded-full opacity-20 group-hover:opacity-40 blur transition duration-500"></div>
                    <img src="${userData.avatar_url}" alt="${userData.login}" class="relative w-32 h-32 rounded-full border-2 border-black object-cover"/>
                </div>
                <h2 class="mt-4 text-2xl font-bold text-white tracking-tight">${userData.name || userData.login}</h2>
                <a href="${userData.html_url}" target="_blank" class="text-zinc-500 hover:text-white transition-colors text-sm font-mono flex items-center gap-1 mt-1">
                    @${userData.login} <i data-lucide="external-link" class="w-3 h-3"></i>
                </a>
                ${userData.bio ? `<p class="mt-4 text-zinc-400 text-sm leading-relaxed">${userData.bio}</p>` : ''}
                <div class="mt-6 w-full grid grid-cols-3 gap-2 border-t border-zinc-800 pt-6">
                    <div class="text-center">
                        <div class="text-lg font-bold text-white">${userData.public_repos}</div>
                        <div class="text-xs text-zinc-600 uppercase tracking-widest text-[10px]">Repos</div>
                    </div>
                    <div class="text-center border-l border-zinc-800">
                        <div class="text-lg font-bold text-white">${userData.followers}</div>
                        <div class="text-xs text-zinc-600 uppercase tracking-widest text-[10px]">Followers</div>
                    </div>
                    <div class="text-center border-l border-zinc-800">
                        <div class="text-lg font-bold text-white">${userData.following}</div>
                        <div class="text-xs text-zinc-600 uppercase tracking-widest text-[10px]">Following</div>
                    </div>
                </div>
                ${userData.location ? `
                <div class="mt-6 w-full flex items-center justify-center gap-2 text-xs text-zinc-500 font-mono uppercase tracking-widest">
                    <span>üìç ${userData.location}</span>
                </div>` : ''}
            `;

            // Repos
            if (repos.length === 0) {
                reposList.innerHTML = `
                    <div class="text-center py-12 bg-zinc-900/50 rounded-xl border border-zinc-800 border-dashed">
                        <p class="text-zinc-500">No public repositories found.</p>
                    </div>`;
            } else {
                reposList.innerHTML = repos.map(repo => `
                    <div class="group relative flex flex-col md:flex-row justify-between p-5 bg-zinc-900 border border-zinc-800 hover:border-zinc-600 rounded-xl transition-all duration-200">
                        <div class="flex-1 min-w-0 pr-4">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-bold text-zinc-200 group-hover:text-white truncate">${repo.name}</h4>
                                <span class="px-2 py-0.5 rounded-full bg-zinc-800 text-[10px] text-zinc-400 border border-zinc-700">${repo.private ? 'Private' : 'Public'}</span>
                            </div>
                            <p class="text-sm text-zinc-400 mb-4 line-clamp-2">${repo.description || "No description provided."}</p>
                            <div class="flex items-center gap-4 text-xs text-zinc-500">
                                ${repo.language ? `<div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-white/20"></span>${repo.language}</div>` : ''}
                                <div class="flex items-center gap-1"><i data-lucide="star" class="w-3.5 h-3.5"></i>${repo.stargazers_count}</div>
                                <div class="flex items-center gap-1"><i data-lucide="git-fork" class="w-3.5 h-3.5"></i>${repo.forks_count}</div>
                            </div>
                        </div>
                        <div class="mt-4 md:mt-0 md:pl-4 md:border-l md:border-zinc-800 flex flex-row md:flex-col justify-center gap-2 shrink-0">
                             <button onclick="openRepo('${repo.id}')" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-white text-black hover:bg-zinc-200 rounded-lg text-sm font-semibold transition-colors">
                               <i data-lucide="code" class="w-4 h-4"></i> View Code
                             </button>
                             <a href="${repo.html_url}" target="_blank" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-zinc-800 text-zinc-300 hover:bg-zinc-700 rounded-lg text-sm font-medium transition-colors">
                               <i data-lucide="external-link" class="w-4 h-4"></i> GitHub
                             </a>
                        </div>
                    </div>
                `).join('');
            }

            dashboard.classList.remove('hidden');
            welcomeState.classList.add('hidden');
            lucide.createIcons();
        }

        // --- Explorer Logic ---
        
        window.openRepo = function(repoId) {
            const repo = repos.find(r => r.id.toString() === repoId.toString());
            if(!repo) return;

            activeRepo = repo;
            currentPath = '';
            fileContent = null;
            
            // Show Modal
            modalBackdrop.classList.remove('hidden');
            // Small timeout to allow transition
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
            }, 10);

            modalRepoName.innerHTML = `${repo.name} <span class="px-2 py-0.5 rounded bg-zinc-800 text-[10px] text-zinc-400 font-normal border border-zinc-700">beta</span>`;
            
            fetchRepoContents(repo.owner.login, repo.name, '');
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modalBackdrop.classList.add('hidden');
                activeRepo = null;
            }, 300);
        }

        async function fetchRepoContents(owner, repo, path) {
            renderModalLoader();
            currentPath = path;
            modalCurrentPath.textContent = path;
            fileContent = null;

            try {
                const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`);
                if (!res.ok) throw new Error('Unable to fetch contents');
                
                const data = await res.json();
                
                if (Array.isArray(data)) {
                    // Directory
                    dirContents = data.sort((a, b) => {
                        if (a.type === 'dir' && b.type !== 'dir') return -1;
                        if (a.type !== 'dir' && b.type === 'dir') return 1;
                        return a.name.localeCompare(b.name);
                    });
                    renderDirContents();
                } else if (data.type === 'file') {
                    // Single File redirect
                    fetchFileContent(data.download_url);
                }
            } catch (err) {
                renderModalError(err.message);
            }
        }

        async function fetchFileContent(url) {
            renderModalLoader();
            try {
                const res = await fetch(url);
                const text = await res.text();
                fileContent = text;
                renderFileContent();
            } catch (err) {
                renderModalError("Failed to load file content");
            }
        }

        function renderModalLoader() {
            modalBody.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center text-zinc-500 gap-3">
                   <i data-lucide="loader-2" class="w-8 h-8 animate-spin"></i>
                   <p class="text-sm font-mono">Retrieving data...</p>
                </div>`;
            lucide.createIcons();
        }

        function renderModalError(msg) {
            modalBody.innerHTML = `
                 <div class="h-full flex flex-col items-center justify-center text-red-400 gap-2 p-8 text-center">
                   <i data-lucide="alert-circle" class="w-8 h-8 opacity-50"></i>
                   <p>${msg}</p>
                   <button onclick="fetchRepoContents('${activeRepo.owner.login}', '${activeRepo.name}', '')" class="text-sm underline hover:text-white mt-2">Retry Root</button>
                 </div>`;
            lucide.createIcons();
        }

        window.handleItemClick = function(path, type, url) {
            if (type === 'dir') {
                fetchRepoContents(activeRepo.owner.login, activeRepo.name, path);
            } else {
                fetchFileContent(url);
            }
        }

        window.navigateUp = function() {
            if (!currentPath) return;
            const newPath = currentPath.split('/').slice(0, -1).join('/');
            
            if (fileContent !== null) {
                // Return to current dir listing if viewing file
                fileContent = null;
                // re-fetch to be safe/simple, or just re-render if we cached it. 
                // For simplicity, re-fetch parent dir
                const parentPath = currentPath; // Actually currentPath IS the file path if we clicked a file? 
                // Note: The logic in React version separates path state.
                // If viewing a file, the path state was the file path.
                
                // If we are in file view, we want to go back to the directory containing the file.
                // My logic above in fetchRepoContents sets currentPath = path.
                // If path was 'src/index.js', currentPath is 'src/index.js'.
                // navigateUp calc newPath = 'src'.
                fetchRepoContents(activeRepo.owner.login, activeRepo.name, newPath);
            } else {
                fetchRepoContents(activeRepo.owner.login, activeRepo.name, newPath);
            }
        }

        function renderDirContents() {
            // Back button logic
            let html = '<div class="divide-y divide-zinc-900">';
            
            if (currentPath) {
                 html += `
                  <div onclick="navigateUp()" class="flex items-center gap-3 px-4 py-3 hover:bg-zinc-900/50 cursor-pointer text-zinc-400 hover:text-blue-400 transition-colors">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    <span class="text-sm font-mono">..</span>
                  </div>`;
            }

            if (dirContents.length === 0) {
                html += '<div class="p-8 text-center text-zinc-600 text-sm">Empty directory</div>';
            } else {
                html += dirContents.map(item => {
                    let icon = 'file-text';
                    let iconColor = 'text-zinc-400';
                    if (item.type === 'dir') { icon = 'folder'; iconColor = 'text-blue-400 fill-blue-400/20'; }
                    else if (item.name.match(/\.(js|jsx|ts|tsx)$/)) { icon = 'file-code'; iconColor = 'text-yellow-400'; }
                    else if (item.name.match(/\.json$/)) { icon = 'file-json'; iconColor = 'text-green-400'; }
                    else if (item.name.match(/\.md$/)) { icon = 'book'; iconColor = 'text-purple-400'; }

                    return `
                      <div onclick="handleItemClick('${item.path}', '${item.type}', '${item.download_url}')" class="flex items-center justify-between px-4 py-3 hover:bg-zinc-900 cursor-pointer group transition-colors">
                        <div class="flex items-center gap-3 min-w-0">
                          <i data-lucide="${icon}" class="w-5 h-5 ${iconColor}"></i>
                          <span class="text-sm font-mono truncate ${item.type === 'dir' ? 'text-zinc-200 group-hover:text-blue-200' : 'text-zinc-400 group-hover:text-zinc-200'}">
                            ${item.name}
                          </span>
                        </div>
                        ${item.type === 'dir' ? '<i data-lucide="chevron-right" class="w-4 h-4 text-zinc-700 group-hover:text-zinc-500"></i>' : 
                        (item.size ? `<span class="text-xs text-zinc-700 font-mono">${(item.size / 1024).toFixed(1)} KB</span>` : '')}
                      </div>
                    `;
                }).join('');
            }
            html += '</div>';
            modalBody.innerHTML = html;
            lucide.createIcons();
        }

        function renderFileContent() {
             modalBody.innerHTML = `
                 <div class="h-full flex flex-col">
                    <div class="bg-zinc-900 border-b border-zinc-800 px-4 py-2 flex items-center gap-2">
                      <button onclick="navigateUp()" class="text-xs text-zinc-400 hover:text-white flex items-center gap-1">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> Back to files
                      </button>
                    </div>
                    <pre class="flex-1 p-4 overflow-auto text-xs sm:text-sm font-mono text-zinc-300 leading-relaxed custom-scrollbar">${escapeHtml(fileContent)}</pre>
                 </div>
             `;
             lucide.createIcons();
        }

        // Helpers
        function setLoading(isLoading) {
            if (isLoading) {
                mainLoader.classList.remove('hidden');
                dashboard.classList.add('hidden');
                welcomeState.classList.add('hidden');
                errorContainer.classList.add('hidden');
            } else {
                mainLoader.classList.add('hidden');
            }
        }

        function setError(msg) {
            if (msg) {
                errorContainer.classList.remove('hidden');
                errorMessage.textContent = msg;
            } else {
                errorContainer.classList.add('hidden');
            }
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
